<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School Activities</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <link href="styles.css" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
    <script src="lessons.js"></script>
</head>

<body>
    <div id="app">
        <main>
            <div v-if="showLesson" class="lessons-container">
                <div class="navbar">
                    <h1>After School Activities</h1>
                    <button v-on:click='showCheckout' v-if="cartItemCount > 0">
                        <!--'cartItemCount is used the same way as a data property'-->
                        {{ cartItemCount }}
                        <!--add the cart icon-->
                        <span class="fas fa-cart-plus"></span>Checkout
                    </button>
                    <button disabled="disabled" v-else style="opacity: 0.7;">
                        <!--'cartItemCount is used the same way as a data property'-->
                        {{ cartItemCount }}
                        <!--add the cart icon-->
                        <span class="fas fa-cart-plus"></span>Checkout
                    </button>
                </div>
                <div class="filter-container">
                    <div class="search-container">
                        <h1>Search</h1>
                        <p>
                            <input type="text" id="search-query" v-model="search_query" placeholder="Search here!">
                        </p>
                    </div>
                    <div class="sort-container">
                        <h1>Sort</h1>
                        <p>
                            <input type="radio" id="subject" value="subject" v-model="sortType">
                            <label for="subject">Subject</label><br>
                            <input type="radio" id="location" value="location" v-model="sortType">
                            <label for="location">Location</label><br>
                            <input type="radio" id="price" value="price" v-model="sortType">
                            <label for="price">Price</label><br>
                            <input type="radio" id="availableInventory" value="availableInventory" v-model="sortType">
                            <label for="availableInventory">Available Inventory</label><br>
                            <input type="radio" id="rating" value="rating" v-model="sortType">
                            <label for="rating">Rating</label><br>
                        </p>
                        <h1>Order</h1>
                        <input type="radio" id="asc" value="ascending" v-model="sortOrder" checked>
                        <label for="asc">Ascending</label><br>
                        <input type="radio" id="desc" value="descending" v-model="sortOrder">
                        <label for="desc">Descending</label><br><br>
                    </div>
                </div>
                <div class="all-lessons-container">
                    <div class="lesson-box" v-for="lesson in sortedLessons">
                        <figure>
                            <!--bind 'src' attr to 'lesson.image' in 'data'-->
                            <img v-bind:src="lesson.image" style="height: 200px; width: 200px;">
                        </figure>
                        <p>
                            <span id="subject-title">{{lesson.subject}}</span> <br><br><br>
                            Location: {{lesson.location}} <br><br>
                            Price: {{lesson.price}} <br><br>
                            Available Inventory: {{lesson.availableInventory}} <br><br><br>

                            <!--This button will be displayed when 'canAddToCart' is True-->
                            <button v-on:click="addToCart(lesson)" v-if="lesson.availableInventory > 0">
                                Add To Cart
                            </button>

                            <!--This button will be displayed otherwise-->
                            <button disabled="disabled" v-else style="opacity: 0.5;">
                                Add To Cart
                            </button>
                            <span v-if="lesson.availableInventory === 0">All out!</span>
                            <span v-else-if="lesson.availableInventory < 5">Only
                                {{lesson.availableInventory}} left!</span>
                            <span v-else>Buy now!</span> <br>

                            <span v-for="n in lesson.rating">★</span>
                            <span v-for="n in 5-lesson.rating">☆</span>
                        </p>
                    </div>
                </div>
            </div>
            <div v-else class="checkout-container">
                <!--CHECKOUT INFORMATION-->
                <div class="navbar">
                    <h1>Checkout</h1>
                    <button v-on:click='showCheckout'>
                        <!--'cartItemCount is used the same way as a data property'-->
                        {{ cartItemCount }}
                        <!--add the cart icon-->
                        <span class="fas fa-cart-plus"></span>Checkout
                    </button>
                </div>
                <div class="cart-items">

                </div>
                <p>
                    <strong>First Name:</strong>
                    <!--This input field is bound to 'firstName' in the 'order' object-->
                    <!-- <input v-model="order.firstName"/> -->
                    <input v-model.trim="order.firstName" />
                </p>
                <p>
                    <strong>Last Name:</strong>
                    <!--This input field is bound to 'lastName' in the 'order' object-->
                    <!-- <input v-model="order.lastName"/> -->
                    <input v-model.trim="order.lastName" />
                </p>
                <p>
                    <strong>Address:</strong>
                    <input v-model="order.address" />
                </p>
                <p>
                    <strong>City:</strong>
                    <input v-model="order.city" />
                </p>
                <p>
                    <strong>State:</strong>
                    <!--Using v-for-->
                    <select v-model="order.state">
                        <option disabled value="">State</option>
                        <option v-for="(state,key) in states" v-bind:value="state">
                            {{key}}
                        </option>
                    </select>
                </p>
                <p>
                    <strong>Zip/Postal Code:</strong>
                    <!-- <input v-model="order.zip"/> -->
                    <input v-model.number="order.zip" type="number" />
                </p>
                <!--Checkbox button-->
                <!--Using v-bind-->
                <p>
                    <input type="checkbox" id="gift" value="true" v-model="order.gift"
                        v-bind:true-value="order.sendGift" v-bind:false-value="order.dontSendGift">
                    <label for="gift">Ship as gift</label>

                </p>
                <!--Radio button-->
                <p>
                    <input type="radio" id="home" value="Home" v-model="order.method">
                    <label for="home">Home</label>
                    <input type="radio" id="business" value="Business" v-model="order.method">
                    <label for="business">Business</label>
                </p>
                <!--ORDER INFORMATION-->
                <h2>Order Information</h2>
                <p>First Name: {{order.firstName}} </p>
                <p>Last Name: {{order.lastName}} </p>
                <p>Address: {{order.address}} </p>
                <p>City: {{order.city}} </p>
                <p>Zip: {{order.zip}} </p>
                <p>State: {{order.state}} </p>
                <p>Gift: {{order.gift}} </p>
                <p>Method: {{order.method}} </p>

                <!--PLACE ORDER BUTTON-->
                <button v-on:click="submitForm">Place Order</button>
            </div>
    </div>


    </main>
    </div>

    <script type="text/javascript">
        let webstore = new Vue({ //The Vue instance
            el: '#app', //The 'option object': DOM mounting point
            data: {
                showLesson: true,
                lessons: lessons,
                order: {
                    firstName: '',
                    lastName: '',
                    address: '',
                    city: '',
                    zip: '',
                    state: '',
                    method: 'Home',
                    // gift: false,
                    sendGift: 'Send as Gift',
                    dontSendGift: 'Do Not Send As Gift'
                },
                states: {
                    AL: 'Alabama',
                    AR: 'Arizona',
                    CA: 'California',
                    NV: 'Nevada'
                },

                cart: [], //array to store items in shopping cart
                sortType: '',
                sortOrder: '',
                search_query: '',
            },
            methods: {
                addToCart: function (lesson) {
                    //console.log(lesson.id);

                    let lessonFound = false;

                    for (let i = 0; i < this.cart.length; i++) {
                        if (this.cart[i].id === lesson.id) {
                            // If the product is already in the cart, increment the quantity
                            this.cart[i].quantity += 1;
                            lessonFound = true;
                            break;
                        }
                    }

                    if (!lessonFound) {
                        // If the product is not in the cart, add it with quantity 1
                        this.cart.push({ "id": lesson.id, quantity: 1 });
                    }

                    // Log each element of the cart individually
                    this.cart.forEach(item => {
                        console.log(`Product ID: ${item.id}, Quantity: ${item.quantity}`);
                        //console.log(item.quantity);
                        //To Reduce availableInventory when item added to cart
                        if (item.id === lesson.id) {
                            if (lesson.availableInventory > 0) {
                                lesson.availableInventory = 5;
                                lesson.availableInventory -= item.quantity;
                                //console.log("From Lessons.js: " + lesson.availableInventory);
                            }
                        }
                    });

                },

                showCheckout() {
                    this.showLesson = this.showLesson ? false : true;
                },
                submitForm() { alert('Order Submitted!') },
            },
            computed: { //the computed property object
                cartItemCount: function () {  //the property name
                    //its value when calculated
                    return this.cart.length || '';
                },
                //Sorting method
                sortedLessons() {
                    let lessonsArray = this.lessons.slice(0);

                    //Sorting price asc
                    if (this.sortType === "price" && this.sortOrder === "ascending") {
                        function compare(a, b) {
                            if (a.price > b.price)
                                return 1;
                            if (a.price < b.price)
                                return -1;
                            return 0;
                        }
                    }
                    //Sorting price desc
                    if (this.sortType === "price" && this.sortOrder === "descending") {
                        function compare(a, b) {
                            if (a.price < b.price)
                                return 1;
                            if (a.price > b.price)
                                return -1;
                            return 0;
                        }
                    }
                    //Sorting rating asc
                    if (this.sortType === "rating" && this.sortOrder === "ascending") {
                        function compare(a, b) {
                            if (a.rating > b.rating)
                                return 1;
                            if (a.rating < b.rating)
                                return -1;
                            return 0;
                        }
                    }
                    //Sorting rating desc
                    if (this.sortType === "rating" && this.sortOrder === "descending") {
                        function compare(a, b) {
                            if (a.rating < b.rating)
                                return 1;
                            if (a.rating > b.rating)
                                return -1;
                            return 0;
                        }
                    }
                    //Sorting available inventory asc
                    if (this.sortType === "availableInventory" && this.sortOrder === "ascending") {
                        function compare(a, b) {
                            if (a.availableInventory > b.availableInventory)
                                return 1;
                            if (a.availableInventory < b.availableInventory)
                                return -1;
                            return 0;
                        }
                    }
                    //Sorting available inventory desc
                    if (this.sortType === "availableInventory" && this.sortOrder === "descending") {
                        function compare(a, b) {
                            if (a.availableInventory < b.availableInventory)
                                return 1;
                            if (a.availableInventory > b.availableInventory)
                                return -1;
                            return 0;
                        }
                    }

                    return lessonsArray.sort(compare);
                }

            }
        });
    </script>
</body>

</html>